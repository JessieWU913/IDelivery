<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cs.qqq.Mapper.UserMapper">


    <insert id="saveUser">
        INSERT INTO sys_user (username, password, role_id, phone, email, status)
        VALUES (#{userName}, #{password}, #{roleId}, #{phone}, #{email}, #{status})
    </insert>


    <update id="updateUser">
        update sys_user set status=#{status} where user_id=#{userId}
    </update>
    <update id="updateUser1">
        UPDATE sys_user 
        SET role_id = #{roleId},
            username = #{userName},
            email = #{email},
            phone = #{phone}
            <if test="password != null and password != ''">
                ,password = #{password}
            </if>
        WHERE user_id = #{userId}
    </update>


    <select id="getAllUsers" resultType="cs.qqq.Entity.SysUser">
           select  * from sys_user,sys_role where sys_user.role_id=sys_role.role_id
    </select>

    <delete id="deleteUserByID">
        delete
        from sys_user
        where user_id = #{id}
    </delete>
    <select id="findUserByUsernameAndPassword" resultType="cs.qqq.Entity.SysUser">
        select * from sys_user where username=#{userName} and password=#{password}
    </select>
    <select id="findUserById" resultType="cs.qqq.Entity.SysUser">
        select * from sys_user where user_id=#{userId}
    </select>
    <select id="findAllUsers" resultType="cs.qqq.Entity.SysUser">
        SELECT *
        FROM sys_user u
        JOIN sys_role r ON u.role_id = r.role_id
        WHERE 1=1
        <if test="roleId != null">
            AND r.role_id = #{roleId}
        </if>
        <if test="userName != null and userName!=''">
            AND u.username LIKE CONCAT('%',#{userName},'%')
        </if>
        <if test="phonenumber != null and phonenumber !=''">
            AND u.phonenumber = #{phonenumber}
        </if>
        <if test="beginTime != null and beginTime !=''   ">
            AND u.create_time &gt;= #{beginTime}
        </if>
        <if test="endTime != null and beginTime !='' ">
            AND u.create_time &lt;= #{endTime}
        </if>
    </select>
    
    <!-- 统计所有用户数量 -->
    <select id="countAllUsers" resultType="long">
        SELECT COUNT(*) FROM sys_user
    </select>
    
    <!-- 根据角色ID查询用户列表 -->
    <select id="getUsersByRoleId" resultType="cs.qqq.Entity.SysUser">
        SELECT * FROM sys_user WHERE role_id = #{roleId}
    </select>
    
    <!-- 根据用户名查询用户 -->
    <select id="findByUsername" resultType="cs.qqq.Entity.SysUser">
        SELECT * FROM sys_user WHERE username = #{username}
    </select>
</mapper>