# 外卖点餐系统 - 部署说明

## 一、环境要求

### 1. 必需软件
- **JDK 1.8** 或更高版本
- **Maven 3.x**
- **MySQL 5.7** 或更高版本

### 2. 检查环境
```bash
# 检查 Java 版本
java -version

# 检查 Maven 版本
mvn -version

# 检查 MySQL 是否运行
mysql --version
```

---

## 二、部署步骤

### 步骤 1：获取项目文件
将整个项目文件夹复制到你的电脑上，例如：`D:\waimai`

### 步骤 2：创建数据库
1. 启动 MySQL 数据库
2. 使用 MySQL 客户端（Navicat、MySQL Workbench 或命令行）连接数据库
3. 创建数据库：
   ```sql
   CREATE DATABASE test CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
   ```

### 步骤 3：导入数据
按顺序执行项目根目录下的 SQL 文件：

1. **打开 `database_init_all.sql` 文件**
2. **复制全部内容**
3. **在 MySQL 客户端中执行**（选择 `test` 数据库）

这会创建以下表：
- `sys_user` - 用户表
- `sys_role` - 角色表
- `t_category` - 菜品分类表（7个分类）
- `t_product` - 菜品表（29个菜品）
- `t_cart` - 购物车表

### 步骤 4：配置数据库连接
打开 `src/main/resources/application.properties`，修改以下配置：

```properties
# 数据库连接（根据你的实际情况修改）
spring.datasource.url=jdbc:mysql://localhost:3306/test?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=你的MySQL密码

# 端口（如果8080被占用，可以改成8081等）
server.port=8080
```

⚠️ **重要**：将 `spring.datasource.password` 改成你自己的 MySQL 密码！

### 步骤 5：复制图片资源（可选）
如果需要显示菜品图片：
1. 将 `img/product/` 文件夹中的图片
2. 复制到 `src/main/resources/static/img/product/` 目录下

**注意**：目前只有宫保鸡丁有图片（gongbao.jpg），其他菜品会显示占位符。

### 步骤 6：启动应用
在项目根目录下打开命令行，执行：

```bash
# Windows PowerShell 或 CMD
mvn spring-boot:run

# 或者先打包再运行
mvn clean package
java -jar target/qqq_qimo-1.0-SNAPSHOT.jar
```

等待看到以下信息表示启动成功：
```
Tomcat started on port(s): 8080 (http) with context path ''
Started qqqExam in x.xxx seconds
```

---

## 三、访问系统

### 1. 打开浏览器
访问：`http://localhost:8080`

### 2. 默认账号
系统提供两种角色的账号：

#### 👤 普通用户（点餐）
- **账号**：`user001`
- **密码**：`123456`
- **功能**：浏览菜单、添加购物车、下单

#### 👨‍💼 管理员（后台管理）
- **账号**：`admin`
- **密码**：`123456`
- **功能**：用户管理、角色管理、文章管理

---

## 四、功能说明

### 普通用户功能
1. **登录后自动跳转到菜单页面**
2. **菜品分类浏览**：点击分类按钮查看不同类别菜品
3. **搜索菜品**：使用搜索框快速找到想要的菜品
4. **加入购物车**：点击"加入购物车"按钮
5. **查看购物车**：点击"购物车"按钮查看已选菜品
6. **调整数量**：在购物车中可以增减数量或删除商品

### 管理员功能
1. **登录后跳转到后台管理页面**
2. **用户管理**：查看、添加、编辑、删除用户
3. **角色管理**：管理用户角色权限
4. **文章管理**：发布和管理文章（如果需要）

---

## 五、常见问题

### ❌ 问题 1：端口 8080 已被占用
**错误信息**：`Address already in use: bind`

**解决方案**：
1. 修改 `application.properties` 中的 `server.port=8081`
2. 或者杀掉占用 8080 的进程：
   ```bash
   # Windows
   netstat -ano | findstr :8080
   taskkill /F /PID <进程ID>
   ```

### ❌ 问题 2：数据库连接失败
**错误信息**：`Access denied for user 'root'@'localhost'`

**解决方案**：
1. 检查 `application.properties` 中的用户名密码是否正确
2. 确保 MySQL 服务已启动
3. 确认数据库 `test` 已创建

### ❌ 问题 3：登录后出现 500 错误
**错误信息**：`Unknown column 'user_name' in 'where clause'`

**解决方案**：
1. 确保 `database_init_all.sql` 完整执行
2. 检查 `sys_user` 表的字段名是 `username`（不是 `user_name`）
3. 重启应用：
   ```bash
   # Ctrl+C 停止应用
   mvn clean spring-boot:run
   ```

### ❌ 问题 4：菜品图片不显示
**解决方案**：
1. 确保已将图片复制到 `src/main/resources/static/img/product/`
2. 图片文件名要与数据库中 `product_img` 字段匹配
3. 当前只有宫保鸡丁有图片，其他显示占位符是正常的

### ❌ 问题 5：添加购物车时返回 403 错误
**错误信息**：`Forbidden`

**解决方案**：
- 这是正常的，系统已配置 CSRF 防护
- 前端页面已自动处理 CSRF token，刷新页面后重试即可

---

## 六、项目结构说明

```
waimai/
├── src/
│   └── main/
│       ├── java/cs/qqq/
│       │   ├── Controller/      # 控制器层（处理请求）
│       │   │   ├── LoginController.java
│       │   │   ├── ProductController.java  # 菜单
│       │   │   ├── CartController.java     # 购物车
│       │   │   └── ...
│       │   ├── Service/         # 业务逻辑层
│       │   ├── Mapper/          # 数据访问层
│       │   ├── Entity/          # 实体类
│       │   └── Config/          # 配置类
│       └── resources/
│           ├── application.properties  # 配置文件 ⚠️ 需要修改
│           ├── mapper/          # MyBatis SQL 映射文件
│           ├── static/          # 静态资源（CSS、JS、图片）
│           └── templates/       # 前端页面
├── database_init_all.sql       # 数据库初始化脚本 ⚠️ 必须执行
└── pom.xml                     # Maven 依赖配置
```

---

## 七、技术栈

- **后端框架**：Spring Boot 2.1.3
- **ORM 框架**：MyBatis 2.0.0
- **模板引擎**：Thymeleaf
- **数据库**：MySQL 5.7+
- **前端框架**：AmazeUI（响应式）
- **安全框架**：Spring Security

---

## 八、联系与支持

如果部署过程中遇到问题：
1. 检查本文档的"常见问题"部分
2. 确保所有环境配置正确
3. 查看控制台错误信息
4. 联系项目作者获取帮助

---

## 附录：快速启动命令

```bash
# 1. 进入项目目录
cd D:\waimai

# 2. 启动应用
mvn spring-boot:run

# 3. 浏览器访问
# http://localhost:8080

# 4. 登录账号
# 用户: user001 / 123456
# 管理员: admin / 123456
```

---

**祝你的朋友部署成功！🎉**
